<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Study Tracker - Compete with Friends</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css" integrity="sha512-2SwdPD6INVrV/lHTZbO2nodKhrnDdJK9/kg2XD1r9uGqPo1cUbujc+IYdlYdEErWNu69gVcYgdxlmVmzTWnetw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>
    <!-- Login/Register Screen -->
    <div id="authScreen" class="screen active">
        <div class="auth-container">
            <h1>ğŸ“š Study Tracker</h1>
            <p class="tagline">Compete with friends while you learn!</p>
            
            <div class="auth-form">
                <input type="text" id="usernameInput" placeholder="Enter your username" />
                <input type="text" id="userIdInput" placeholder="Your unique ID (auto-generated)" readonly />
                <button onclick="login()" class="btn-primary">Start Learning</button>
            </div>
            <p id="statusMessage" style="color: red; margin-top: 10px; font-size: 14px;"></p>
        </div>
    </div>

    <!-- Main Dashboard -->
    <div id="dashboardScreen" class="screen">
        <nav class="navbar">
            <div class="nav-brand">ğŸ“š Study Tracker</div>
            <div class="nav-user">
                <span id="navUsername"></span>
                <span class="user-id">ID: <span id="navUserId"></span></span>
                <span class="points-badge" id="navPoints">0 pts</span>
                <button onclick="logout()" class="btn-logout">Logout</button>
            </div>
        </nav>

        <div class="dashboard-container">
            <!-- Sidebar -->
            <aside class="sidebar">
                <button class="menu-btn active" onclick="showSection('chapters')">
                    ğŸ“– My Chapters
                </button>
                <button class="menu-btn" onclick="showSection('friends')">
                    ğŸ‘¥ Friends
                </button>
                <button class="menu-btn" onclick="showSection('leaderboard')">
                    ğŸ† Leaderboard
                </button>
                <button class="menu-btn" onclick="showSection('stats')">
                    ğŸ“Š My Stats
                </button>
            </aside>

            <!-- Main Content -->
            <main class="main-content">
                <!-- Chapters Section -->
                <section id="chaptersSection" class="content-section active">
                    <div class="section-header">
                        <h2 id="my">My Chapters</h2>
                        <button onclick="openAddChapterModal()" class="btn-primary">+ Add Chapter</button>
                    </div>

                    <div class="chapters-grid" id="chaptersGrid">
                        <div class="empty-state">
                            <p>No chapters yet. Add your first chapter to start earning points!</p>
                        </div>
                    </div>
                </section>

                <!-- Friends Section -->
                <section id="friendsSection" class="content-section">
                    <div class="section-header">
                        <h2>Friends</h2>
                        <button onclick="openAddFriendModal()" class="btn-primary">+ Add Friend</button>
                    </div>

                    <div class="friends-list" id="friendsList">
                        <div class="empty-state">
                            <p>ğŸ‘¥ No friends added yet. Add friends to compete!</p>
                        </div>
                    </div>
                </section>

                <!-- Leaderboard Section -->
                <section id="leaderboardSection" class="content-section">
                    <div class="section-header">
                        <h2>ğŸ† Leaderboard</h2>
                    </div>

                    <div class="leaderboard" id="leaderboard">
                        <div class="empty-state">
                            <p>Add friends to see the leaderboard!</p>
                        </div>
                    </div>
                </section>

                <!-- Stats Section -->
                <section id="statsSection" class="content-section">
                    <div class="section-header">
                        <h2>ğŸ“Š My Statistics</h2>
                    </div>

                    <div class="stats-container">
                        <div class="stats-cards">
                            <div class="stat-card">
                                <div class="stat-value" id="totalChapters">0</div>
                                <div class="stat-label">Total Chapters</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="completedChapters">0</div>
                                <div class="stat-label">Completed</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="totalPoints">0</div>
                                <div class="stat-label">Total Points</div>
                            </div>
                        </div>

                        <div class="chart-tabs">
                            <button class="chart-tab active" onclick="switchChart('day')">Day</button>
                            <button class="chart-tab" onclick="switchChart('week')">Week</button>
                            <button class="chart-tab" onclick="switchChart('month')">Month</button>
                        </div>

                        <div class="chart-container">
                            <canvas id="pointsChart"></canvas>
                        </div>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <!-- Add Chapter Modal -->
    <div id="addChapterModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add New Chapter</h3>
                <span class="close" onclick="closeAddChapterModal()">&times;</span>
            </div>
            <div class="modal-body">
                <input type="text" id="chapterName" placeholder="Chapter name" />
                <textarea id="chapterDescription" placeholder="Description (optional)" rows="3"></textarea>
                <button onclick="addChapter()" class="btn-primary">Add Chapter</button>
            </div>
        </div>
    </div>

    <!-- Quiz Modal -->
    <div id="quizModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Chapter Checkpoint</h3>
            </div>
            <div class="modal-body">
                <p class="quiz-question">Have you completed this chapter?</p>
                <div class="quiz-options">
                    <label class="quiz-option">
                        <input type="radio" name="completed" value="yes" />
                        <span>âœ… Yes, I've completed it</span>
                    </label>
                    <label class="quiz-option">
                        <input type="radio" name="completed" value="no" />
                        <span>âŒ No, still working on it</span>
                    </label>
                </div>
                <button onclick="submitQuiz()" class="btn-primary">Submit</button>
                <button onclick="closeQuizModal()" class="btn-secondary">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Add Friend Modal -->
    <div id="addFriendModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add Friend</h3>
                <span class="close" onclick="closeAddFriendModal()">&times;</span>
            </div>
            <div class="modal-body">
                <input type="text" id="friendId" placeholder="Enter friend's ID" />
                <button onclick="addFriend()" class="btn-primary">Add Friend</button>
            </div>
        </div>
    </div>

    <!-- Friend Chapters Modal -->
    <div id="friendChaptersModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="friendChaptersTitle">Friend's Chapters</h3>
                <span class="close" onclick="closeFriendChaptersModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div id="friendChaptersContent"></div>
            </div>
        </div>
    </div>

    <!-- Success Toast -->
    <div id="toast" class="toast"></div>

    <!-- Firebase SDK -->
    <script type="module">
        // Import Firebase modules
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';
        import { getDatabase, ref, set, get, update, onValue } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js';

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBVcHU9Loi8pzDWXkc5RJ9Ox8OzQKR2qJQ",
            authDomain: "study-tracker-147df.firebaseapp.com",
            databaseURL: "https://study-tracker-147df-default-rtdb.firebaseio.com",
            projectId: "study-tracker-147df",
            storageBucket: "study-tracker-147df.firebasestorage.app",
            messagingSenderId: "866788004852",
            appId: "1:866788004852:web:fc2d8114951d119e8d5fa1"
        };

        // Initialize Firebase
        try {
            const app = initializeApp(firebaseConfig);
            const database = getDatabase(app);

            // Make database available globally
            window.db = database;
            window.dbRef = ref;
            window.dbSet = set;
            window.dbGet = get;
            window.dbUpdate = update;
            window.dbOnValue = onValue;
            window.firebaseReady = true;
            
            console.log('âœ… Firebase initialized successfully!');
            
            // Signal that Firebase is ready
            window.dispatchEvent(new Event('firebaseReady'));
        } catch (error) {
            console.error('âŒ Firebase initialization error:', error);
            document.getElementById('statusMessage').textContent = 'Firebase connection error: ' + error.message;
            window.firebaseReady = false;
        }
    </script>
    
    <script src="script.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="script.js"></script>
</body>
</html>
